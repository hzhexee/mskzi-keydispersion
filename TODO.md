# Протоколы распределения ключей

## 1.1. Протокол Нидхема-Шрёдера (Needham-Schroeder protocol) на симметричных ключах

Данный протокол лежит в основе большого количества протоколов распространения
ключей, использующих доверенные центры. Существует два вида данного протокола:
* Протокол Нидхема-Шрёдера на симметричных ключах;
* Протокол Нидхема-Шрёдера на ассиметричных ключах.

Протокол на симметричных ключах работает следующим образом:

### Предварительный этап:
1. Необходимо наличие долговременных ключей $E_A$ и $E_B$ для общения с
доверенного центра Т с А и B соответственно;
2. А и B выбирают случайные одноразовые числа $N_A$ и $N_B$ соответственно.

### Рабочий этап:
1. Алиса отправляет Тренту сообщение, состоящее из идентификаторов Алисы,
Боба и случайного числа $N_A$: $M_0 = A, B, N_A$;
2. На основании полученных данных Трент формирует сообщение, имеющее
следующий вид: $M_1 = E_A(N_A, B, K, E_B(K, A))$, где K – новый сеансовый ключ;
3. Алиса расшифровывает сообщение и проверяет его подлинность, осуществляя
поиск числа $N_A$. После этого она отправляет часть сообщения, зашифрованную на ключе $E_B$
Бобу: $M_2 = E_B(K, A)$;
4. Боб получает и расшифровывает сообщение, достает из него ключ K и
формирует сообщение для Алисы, состоящее из его случайного числа $N_B$, зашифрованного
на ключе К: $M_3 = E_K(N_B)$;
5. Алиса получает сообщение, получает из него $N_B$, меняет его и отправляет его
обратно Бобу: $M_4 = E_K(N_B - 1)$;
6. Алиса и Боб владеют общим секретным ключом K.

## 1.2. Протокол Нидхема-Шрёдера (Needham-Schroeder protocol) на aсимметричных ключах

Протокол с применением ассиметричных ключей работает так:

### Рабочий этап:
1. Алиса выбирает свою часть ключа, $k_A$, и формирует сообщение, в которое кладет
свой идентификатор и $k_A$. Сообщение шифруется с помощью открытого ключа Боба: $M_0 =
P_B(A, k_A)$;
2. Боб расшифровывает сообщение, выбирает свою часть ключа $k_B$ и отправляет
сообщение Алисе, состоящее из его части ключа и части ключа Алисы, полученной из
расшифрованного сообщение. Сообщение Боба зашифровано открытым ключом
Алисы: $M_1 = P_A(k_A, k_B)$;
3. Алиса расшифровывает сообщение и забирает оттуда $k_A$, убедившись в том, что
она осуществляла связь именно с Бобом. После этого она отправляет Бобу его часть ключа,
зашифрованную на открытом ключе Боба: $M_2 = P_B(k_B)$;
4. Боб, получив сообщение и расшифровав его, убеждается в том, что он
осуществлял связь именно с Алисой. При этом Алиса и Боб осуществили не только
получение общего ключа, состоящего из $k_A$, $k_B$, но и взаимную аутентификацию

## 1.3. Протокол Kerberos

Протокол Kerberos является одной из реализаций протокола аутентификации
Нидама-Шрёдера с использованием третьей стороны, призванной уменьшить количество
сообщений, которыми обмениваются стороны.

### Рабочий этап:
1. Алиса отправляет Тренту сообщение, состоящее из идентификаторов Алисы и
Боба: 𝑀0 = 𝐴, 𝐵;
2. На основании полученных данных Трент формирует сообщение, состоящее из
двух частей и отправляет его Алисе: 𝑀1 = {𝐸𝐴(𝑇𝑇, 𝐿, 𝐵, 𝐾), 𝐸𝐵(𝑇𝑇, 𝐿, 𝐴, 𝐾)}, где K – новый
сеансовый ключ;
3. Алиса создает сообщение из собственного идентификатора и метки времени 𝑇𝑇,
шифрует его на сеансовом ключе и посылает Бобу вместе со второй половиной сообщения,
полученного от Трента: 𝑀2 = {𝐸𝐾(𝐴, 𝑇𝑇), 𝐸𝐵(𝑇𝑇, 𝐿, 𝐴, 𝐾)};
4. Боб получает и расшифровывает сообщение и проверяет метку времени. Затем,
в целях собственной аутентификации, Боб шифрует модифицированную метку времени
𝑇𝑇 + 1 на общем сеансовом ключе: 𝑀3 = 𝐸𝐾(𝑇𝑇 + 1);

## 1.4. Протокол Отвея-Рииса (Otway-Rees Protocol)
Перед началом протокола имеется:
- Доверенный центр Трент;
- Пользователи Алиса и Боб, ключи для общения с Трентом 𝐸𝐴 и 𝐸𝐵
соответственно;
- Алиса выбирает числа 𝑁 и 𝑁𝐴, Боб выбирает 𝑁𝐵;

### Рабочий этап:
1. Алиса формирует сообщения для Боба, в котором передаются незашифрованные
N, A, B, а также N, A, B и 𝑁𝐴, зашифрованные на облщем ключе Алисы и Трента: 𝑀0 =
𝑁, 𝐴, 𝐵, 𝐸𝐴(𝑁𝐴, 𝑁, 𝐴, 𝐵) ;
2. Боб получает сообщение и добавляет к нему еще одну строку, которую он
шифрует на общем ключе Трента и Боба: 𝑀1 = 𝑁, 𝐴, 𝐵, 𝐸𝐴(𝑁𝐴, 𝑁, 𝐴, 𝐵), 𝐸𝐵(𝑁𝐵, 𝑁, 𝐴, 𝐵) ;
3. Трент, зная оба ключа, расшифровывает сообщения Алисы и Боба. Далее Трент
подтверждает тот факт, что Трент – это он и формирует общий ключ К: 𝑀2 =
𝐸𝐴(𝑁𝐴, 𝐾), 𝐸𝐵(𝑁𝐵, 𝐾).
4. Боб получает и расшифровывает сообщени, затем убеждается в том, что
сообщение пришло от Трента. Боб принимает сгенерированный ключ К и отправляет Алисе
первую часть сообщения Трента: 𝑀4 = 𝐸𝐴(𝑁𝐴, 𝐾);
5. Алиса принимает сообщение, удостоверяется в том, что оно от Трента и принимает сгенерированный ключ K